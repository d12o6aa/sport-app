
<!-- templates/athlete/workout/create_workout.html -->
{% extends "shared/base.html" %}
{% block style%}
  <style>
  /* Body Part Cards */
  .body-part-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    padding: 1rem;
    text-align: center;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    height: 100px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .body-part-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  }

  .body-part-card.selected {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    transform: scale(1.05);
  }

  .body-part-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .body-part-name {
    font-weight: 600;
    font-size: 0.9rem;
  }

  /* Exercise Items */
  .exercise-item {
    display: flex;
    align-items: center;
    padding: 0.75rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    transition: background-color 0.2s ease;
  }

  .exercise-item:hover {
    background-color: #f8f9fa;
  }

  .exercise-thumb {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    margin-right: 1rem;
    object-fit: cover;
  }

  .exercise-details {
    flex-grow: 1;
  }

  .exercise-name {
    font-weight: 500;
    font-size: 0.9rem;
  }

  .exercise-duration {
    color: #6c757d;
    font-size: 0.8rem;
  }

  /* Workout Sections */
  .workout-section {
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 1rem;
  }

  .section-header {
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #dee2e6;
  }

  /* Level Options */
  .level-options .form-check {
    margin-bottom: 1rem;
    padding: 0.75rem;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .level-options .form-check:hover {
    border-color: #20c997;
  }

  .level-options .form-check-input:checked + .form-check-label {
    color: #495057;
  }

  .level-options .form-check-input:checked ~ * {
    border-color: #20c997;
  }

  /* Stats Display */
  .stat-number {
    font-size: 1.5rem;
    font-weight: 700;
    color: #495057;
  }

  .stat-label {
    font-size: 0.8rem;
    color: #6c757d;
    text-transform: uppercase;
  }

  /* Filter Cards */
  .filter-card {
    border: 2px solid transparent;
    transition: all 0.2s ease;
  }

  .filter-card.active {
    border-color: #20c997;
    background-color: #e8f9f5;
  }

  /* Top Workout Cards */
  .top-workout-item {
    display: flex;
    align-items: center;
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    border-radius: 8px;
    background-color: #f8f9fa;
    transition: all 0.2s ease;
  }

  .top-workout-item:hover {
    background-color: #e9ecef;
    transform: translateX(5px);
  }

  .rank-badge {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    margin-right: 1rem;
  }

  .rank-1 { background: linear-gradient(135deg, #ffd700, #ffed4e); color: #333; }
  .rank-2 { background: linear-gradient(135deg, #c0c0c0, #e5e5e5); color: #333; }
  .rank-3 { background: linear-gradient(135deg, #cd7f32, #daa520); color: white; }
  .rank-default { background: #6c757d; color: white; }

  /* Achievement Badges */
  .achievement-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border-radius: 20px;
    font-size: 0.8rem;
    margin: 0.25rem;
  }

  /* Responsive Improvements */
  @media (max-width: 768px) {
    .body-part-card {
      height: 80px;
    }
    
    .body-part-icon {
      font-size: 1.5rem;
    }
    
    .exercise-thumb {
      width: 30px;
      height: 30px;
    }
  }
  </style>
{% endblock %}

{% block content %}
<section class="section">
  <h5 class="mb-4">Create Custom Workout</h5>

  <form id="customWorkoutForm" class="row g-4">
    <!-- Left Column: Workout Details -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-header">
          <h6 class="mb-0">Workout Details</h6>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Workout Name</label>
            <input type="text" class="form-control" id="workoutName" placeholder="Enter workout name">
          </div>
          
          <div class="mb-3">
            <label class="form-label">Choose Level</label>
            <div class="level-options">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="workoutLevel" id="beginner" value="beginner" checked>
                <label class="form-check-label" for="beginner">
                  <span class="badge bg-success">Beginner</span>
                  <small class="text-muted d-block">Great to start training</small>
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="workoutLevel" id="medium" value="intermediate">
                <label class="form-check-label" for="medium">
                  <span class="badge bg-warning">Medium</span>
                  <small class="text-muted d-block">Train 3-4 times a week</small>
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="workoutLevel" id="advanced" value="advanced">
                <label class="form-check-label" for="advanced">
                  <span class="badge bg-danger">Advanced</span>
                  <small class="text-muted d-block">Train more than 5 times a week</small>
                </label>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Choose Equipment</label>
            <select class="form-select" id="equipment">
              <option>2 Dumbbells, Mat</option>
              <option>Bodyweight Only</option>
              <option>Full Gym Equipment</option>
              <option>Resistance Bands</option>
              <option>Kettlebells</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Choose Focus Area</label>
            <select class="form-select" id="focusArea">
              <option>Legs, Core muscles</option>
              <option>Full Body</option>
              <option>Upper Body</option>
              <option>Lower Body</option>
              <option>Cardio</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Irregular training</label>
            <small class="text-muted d-block">Train 1-2 times a week</small>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="includeWarmup" checked>
            <label class="form-check-label" for="includeWarmup">
              Includes Warm-Up
            </label>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="includeStretching" checked>
            <label class="form-check-label" for="includeStretching">
              Includes Stretching
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: Workout Preview -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h6 class="mb-0">Full body workout</h6>
          <button type="button" class="btn btn-sm btn-outline-primary">
            <i class="bi bi-pencil"></i>
          </button>
        </div>
        <div class="card-body">
          <!-- Workout Stats -->
          <div class="row text-center mb-4">
            <div class="col-4">
              <div class="stat-number">12</div>
              <div class="stat-label">Exercises</div>
            </div>
            <div class="col-4">
              <div class="stat-number">30:00</div>
              <div class="stat-label">Time</div>
            </div>
            <div class="col-4">
              <div class="stat-number">260</div>
              <div class="stat-label">Calories</div>
            </div>
          </div>

          <!-- Warm-up Section -->
          <div class="workout-section mb-3">
            <div class="section-header d-flex justify-content-between align-items-center">
              <h6 class="mb-0">Warm-Up</h6>
              <small class="text-muted">Edit</small>
            </div>
            <div class="exercise-list">
              <div class="exercise-item">
                <img src="https://via.placeholder.com/40x40" class="exercise-thumb">
                <div class="exercise-details">
                  <div class="exercise-name">Double Heel</div>
                  <div class="exercise-duration">x 20</div>
                </div>
                <i class="bi bi-info-circle text-muted"></i>
              </div>
              <div class="exercise-item">
                <img src="https://via.placeholder.com/40x40" class="exercise-thumb">
                <div class="exercise-details">
                  <div class="exercise-name">Lung Jumps Alternated</div>
                </div>
                <i class="bi bi-info-circle text-muted"></i>
              </div>
            </div>
          </div>

          <!-- Main Workout Section -->
          <div class="workout-section mb-3">
            <div class="section-header d-flex justify-content-between align-items-center">
              <h6 class="mb-0">Workout</h6>
              <button class="btn btn-sm btn-outline-success">
                <i class="bi bi-plus"></i> Add Exercises
              </button>
            </div>
            <div id="workoutExercises" class="exercise-list">
              <!-- Exercises will be added here -->
            </div>
          </div>

          <!-- Stretching Section -->
          <div class="workout-section">
            <div class="section-header d-flex justify-content-between align-items-center">
              <h6 class="mb-0">Stretching</h6>
              <small class="text-muted">Edit</small>
            </div>
            <div class="exercise-list">
              <div class="exercise-item">
                <img src="https://via.placeholder.com/40x40" class="exercise-thumb">
                <div class="exercise-details">
                  <div class="exercise-name">Double Heel Taps</div>
                  <div class="exercise-duration">x 20</div>
                </div>
                <i class="bi bi-info-circle text-muted"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer text-center">
          <button type="submit" class="btn btn-success w-100">
            <i class="bi bi-check-circle"></i> Create Workout
          </button>
        </div>
      </div>
    </div>
  </form>
</section>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='assets/js/bootstrap.bundle.min.js') }}"></script>

   <script>
  // Global variables for workout pages
  let selectedBodyParts = [];
  let filteredWorkouts = [];
  let topWorkouts = [];
  let workoutExercises = []; // New array to hold exercises for the custom workout

  // Define WORKOUT_CONFIGS here or ensure it's loaded from another file
  const WORKOUT_CONFIGS = {
      strength: { emoji: '💪', color: '#f56a6a', bgGradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' },
      cardio: { emoji: '🏃', color: '#4CAF50', bgGradient: 'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)' },
      yoga: { emoji: '🧘‍♀️', color: '#2196F3', bgGradient: 'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)' },
      HIIT: { emoji: '⚡', color: '#FF9800', bgGradient: 'linear-gradient(135deg, #f6d365 0%, #fda085 100%)' },
      recovery: { emoji: '😌', color: '#607D8B', bgGradient: 'linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)' }
  };
  
  // ================================
  // Create Workout Page Functions  
  // ================================

  function createCustomWorkout() {
    const workoutName = document.getElementById('workoutName').value;
    const workoutLevel = document.querySelector('input[name="workoutLevel"]:checked').value;
    const equipment = document.getElementById('equipment').value;
    const focusArea = document.getElementById('focusArea').value;
    
    // Get workout details from the preview section
    const actual_duration = document.getElementById('workout-total-time').textContent.split(':')[0] * 60 + parseInt(document.getElementById('workout-total-time').textContent.split(':')[1]);
    const calories_burned = parseInt(document.getElementById('workout-total-calories').textContent);

    const workoutData = {
      title: workoutName,
      workout_type: 'custom',
      difficulty_level: workoutLevel,
      equipment: equipment,
      focusArea: focusArea,
      duration: actual_duration,
      calories: calories_burned,
      workout_details: JSON.stringify(workoutExercises)
    };

    fetch('/athlete/api/workouts/create', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(workoutData)
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(data => {
      alert('Custom workout created successfully! Redirecting...');
      window.location.href = `/athlete/workout/${data.id}`; // Redirect to the new workout page
    })
    .catch(error => {
      console.error('Error creating workout:', error);
      alert('Failed to create workout. Please try again.');
    });
  }

  // ================================
  // Body Workout Page Functions (Moved here for integration)
  // ================================

  function selectBodyPart(bodyPart) {
    const cardElement = event.currentTarget;
    const isSelected = cardElement.classList.contains('selected');
    
    if (isSelected) {
      cardElement.classList.remove('selected');
      selectedBodyParts = selectedBodyParts.filter(part => part !== bodyPart);
    } else {
      cardElement.classList.add('selected');
      selectedBodyParts.push(bodyPart);
    }
    
    updateSelectedBodyPartBadge();
    loadExercisesByBodyPart();
  }

  function updateSelectedBodyPartBadge() {
    const badge = document.getElementById('selectedBodyPart');
    if (badge) {
      if (selectedBodyParts.length === 0) {
        badge.textContent = 'Select body part';
        badge.className = 'badge bg-info';
      } else {
        badge.textContent = selectedBodyParts.join(', ');
        badge.className = 'badge bg-success';
      }
    }
  }

  function loadExercisesByBodyPart() {
    const container = document.getElementById('recommendedExercises');
    if (!container) return;
    
    if (selectedBodyParts.length === 0) {
      container.innerHTML = `
        <div class="col-12 text-center text-muted py-5">
          <i class="bi bi-cursor-text fs-1"></i>
          <p class="mt-2">Select a body part to see recommended exercises</p>
        </div>
      `;
      return;
    }
    
    fetch(`/athlete/api/exercises?body_part=${selectedBodyParts.join(',')}`)
      .then(response => response.json())
      .then(exercises => {
        container.innerHTML = exercises.map(exercise => `
          <div class="col-md-6">
            <div class="exercise-item">
              <img src="${exercise.image_url}" class="exercise-thumb" alt="${exercise.name}">
              <div class="exercise-details">
                <div class="exercise-name">${exercise.name}</div>
                <div class="exercise-duration">${exercise.reps}</div>
              </div>
              <button class="btn btn-sm btn-outline-primary" onclick="addToWorkout('${exercise.name}')">
                Add
              </button>
            </div>
          </div>
        `).join('');
      })
      .catch(error => {
        console.error('Error loading exercises:', error);
        container.innerHTML = `<div class="text-center text-danger">Failed to load exercises.</div>`;
      });
  }

  function addToWorkout(exerciseName) {
    // A function to add exercises to the workout plan
    // This would need a more complex implementation to handle sets, reps, etc.
    alert(`${exerciseName} added to your workout!`);
    workoutExercises.push({ name: exerciseName });
    // Update the workout preview on the create page
  }

  // ================================
  // Initialize Page Functions
  // ================================

  document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('customWorkoutForm')) {
      document.getElementById('customWorkoutForm').addEventListener('submit', function(e) {
        e.preventDefault();
        createCustomWorkout();
      });
    }
    if (document.getElementById('selectedBodyPart')) {
      updateSelectedBodyPartBadge();
    }
    
    // Add event listeners for filter and top pages if they are on the same script
    // Note: It's better to have separate JS files for each page
    if (document.getElementById('typeFilter')) {
        applyFilters();
    } else if (document.getElementById('topWorkoutsTable')) {
        showTopWorkouts('calories');
    }
  });

  // Helper functions (move to a separate file for better organization)
  function formatDate(dateString) {
      const options = { year: 'numeric', month: 'short', day: 'numeric' };
      return new Date(dateString).toLocaleDateString(undefined, options);
  }
  
  function alertShow(message, type) {
      console.log(`Alert (${type}): ${message}`);
      // Implement a UI alert system here
  }
  </script>
{% endblock %}