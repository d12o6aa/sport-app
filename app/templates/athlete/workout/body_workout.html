{% extends "shared/base.html" %}

{% block style%}
  <style>
  /* All your existing CSS styles are kept here */
  .body-part-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    padding: 1rem;
    text-align: center;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    height: 100px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .body-part-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  }

  .body-part-card.selected {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    transform: scale(1.05);
  }

  .body-part-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .body-part-name {
    font-weight: 600;
    font-size: 0.9rem;
  }

  .exercise-item {
    display: flex;
    align-items: center;
    padding: 0.75rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    transition: background-color 0.2s ease;
  }

  .exercise-item:hover {
    background-color: #f8f9fa;
  }

  .exercise-thumb {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    margin-right: 1rem;
    object-fit: cover;
  }

  .exercise-details {
    flex-grow: 1;
  }

  .exercise-name {
    font-weight: 500;
    font-size: 0.9rem;
  }

  .exercise-duration {
    color: #6c757d;
    font-size: 0.8rem;
  }
  
  </style>
{% endblock %}

{% block content %}
<section class="section">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h5 class="m-0">Body Workout</h5>
    <button class="btn btn-primary" onclick="startQuickWorkout()">
      <i class="bi bi-play-circle"></i> Quick Workout
    </button>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <h6 class="card-title">Target Body Parts</h6>
      <div class="row g-3">
        <div class="col-md-2 col-sm-3 col-4">
          <div class="body-part-card" onclick="selectBodyPart('chest', event)">
            <div class="body-part-icon">üí™</div>
            <div class="body-part-name">Chest</div>
          </div>
        </div>
        <div class="col-md-2 col-sm-3 col-4">
          <div class="body-part-card" onclick="selectBodyPart('back', event)">
            <div class="body-part-icon">üèãÔ∏è</div>
            <div class="body-part-name">Back</div>
          </div>
        </div>
        <div class="col-md-2 col-sm-3 col-4">
          <div class="body-part-card" onclick="selectBodyPart('legs', event)">
            <div class="body-part-icon">ü¶µ</div>
            <div class="body-part-name">Legs</div>
          </div>
        </div>
        <div class="col-md-2 col-sm-3 col-4">
          <div class="body-part-card" onclick="selectBodyPart('arms', event)">
            <div class="body-part-icon">üí™</div>
            <div class="body-part-name">Arms</div>
          </div>
        </div>
        <div class="col-md-2 col-sm-3 col-4">
          <div class="body-part-card" onclick="selectBodyPart('core', event)">
            <div class="body-part-icon">üéØ</div>
            <div class="body-part-name">Core</div>
          </div>
        </div>
        <div class="col-md-2 col-sm-3 col-4">
          <div class="body-part-card" onclick="selectBodyPart('shoulders', event)">
            <div class="body-part-icon">ü§∏</div>
            <div class="body-part-name">Shoulders</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h6 class="mb-0">Recommended Exercises</h6>
      <span class="badge bg-info" id="selectedBodyPart">Select body part</span>
    </div>
    <div class="card-body">
      <div id="recommendedExercises" class="row g-3">
        <div class="col-12 text-center text-muted py-5">
          <i class="bi bi-cursor-text fs-1"></i>
          <p class="mt-2">Select a body part to see recommended exercises</p>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
{% block scripts %}
  <script src="{{ url_for('static', filename='assets/js/bootstrap.bundle.min.js') }}"></script>

  <script>
  // Global variable to store selected body parts
  let selectedBodyParts = [];

  // ================================
  // Body Workout Page Functions
  // ================================

  function selectBodyPart(bodyPart, event) {
    const cardElement = event.currentTarget;
    const isSelected = cardElement.classList.contains('selected');
    
    if (isSelected) {
      cardElement.classList.remove('selected');
      selectedBodyParts = selectedBodyParts.filter(part => part !== bodyPart);
    } else {
      cardElement.classList.add('selected');
      selectedBodyParts.push(bodyPart);
    }
    
    updateSelectedBodyPartBadge();
    loadRecommendedExercises();
  }

  function updateSelectedBodyPartBadge() {
    const badge = document.getElementById('selectedBodyPart');
    if (badge) {
      if (selectedBodyParts.length === 0) {
        badge.textContent = 'Select body part';
        badge.className = 'badge bg-info';
      } else {
        badge.textContent = selectedBodyParts.join(', ');
        badge.className = 'badge bg-success';
      }
    }
  }

  function loadRecommendedExercises() {
    const container = document.getElementById('recommendedExercises');
    if (!container) return;
    
    if (selectedBodyParts.length === 0) {
      container.innerHTML = `
        <div class="col-12 text-center text-muted py-5">
          <i class="bi bi-cursor-text fs-1"></i>
          <p class="mt-2">Select a body part to see recommended exercises</p>
        </div>
      `;
      return;
    }
    
    // Fetch exercises from the API based on selected body parts
    const bodyPartsQuery = selectedBodyParts.join(',');
    fetch(`/athlete/api/exercises?body_part=${bodyPartsQuery}`)
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(exercises => {
        if (exercises.length === 0) {
            container.innerHTML = `<div class="col-12 text-center text-muted py-5"><p>No exercises found for these body parts.</p></div>`;
            return;
        }

        container.innerHTML = exercises.map(exercise => `
            <div class="col-md-6">
                <div class="exercise-item">
                    <img src="${exercise.image_url}" class="exercise-thumb" alt="${exercise.name}">
                    <div class="exercise-details">
                        <div class="exercise-name">${exercise.name}</div>
                        <div class="exercise-duration">${exercise.reps || 'Sets & Reps'}</div>
                    </div>
                    <button class="btn btn-sm btn-outline-primary" onclick="addToWorkout('${exercise.name}')">
                        Add
                    </button>
                </div>
            </div>
        `).join('');
    })
    .catch(error => {
      console.error('Error fetching exercises:', error);
      container.innerHTML = `<div class="col-12 text-center text-danger py-5"><p>Failed to load exercises. Please try again later.</p></div>`;
    });
  }

  function startQuickWorkout() {
    if (selectedBodyParts.length === 0) {
      alert('Please select at least one body part to start a quick workout.', 'warning');
      return;
    }
    
    // In a real app, this would create a workout log and redirect to a workout summary or timer page.
    alert('Quick workout started!', 'success');
  }

  function addToWorkout(exerciseName) {
    alert(`${exerciseName} added to your workout!`);
    // This function would be used to dynamically add exercises to a workout plan,
    // possibly updating a list on the same page or in a modal.
  }
  
  function alert(message, type) {
      console.log(`Alert (${type}): ${message}`);
      // In a real application, you'd show a toast or a modal.
  }

  // Initialize page-specific functions when DOM loads
  document.addEventListener('DOMContentLoaded', function() {
    updateSelectedBodyPartBadge();
  });
  </script>
{% endblock %}